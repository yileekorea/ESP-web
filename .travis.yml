language: python
python:
- '2.7'
sudo: false
cache:
  directories:
  - "~/.platformio"
install:
- pip install -U platformio
- platformio platform install espressif8266 --with-package tool-mkspiffs
script:
- platformio --version
- platformio run -e io2life_deploy
- platformio run -t buildfs -e io2life_deploy

after_success:
  # CREATE GIT TAG
  - git config --global user.email "builds@travis-ci.com"
  - git config --global user.name "Travis CI"
  - export GIT_TAG=build-$TRAVIS_BRANCH-$(date -u "+%Y-%m-%d")-$TRAVIS_BUILD_NUMBER
  - echo -n $GIT_TAG > public/version
  - git commit -m "Set build VERSION number" public/version
  - git tag $GIT_TAG -a -m "Generated tag from TravisCI build $TRAVIS_BUILD_NUMBER"
  - git push --quiet https://$GITHUBKEY@github.com/yileekorea/ESP-web $GIT_TAG > /dev/null 2>&1
  except:
    - /^build-[0-9a-z\-]*/

deploy:
  provider: releases
  skip_cleanup: true
  overwrite: true
  file:
  #- ".pioenvs/io2life_deploy/firmware.bin"
  - ".pioenvs/io2life_deploy/spiffs.bin"
  on:
    repo: yileekorea/ESP-web
    all_branches: true
    condition: $TRAVIS_TAG =~ ^[0-9]+\.[0-9]+\.[0-9]+$
  api-key:
    secure: nV0uMGyRNkq2wzSlOJ3V0f33DwYvrU8/rF925fGXVD7d1VrL7KhVc5OXT2e9NP+3ZeGDIEdHhnwSfHTnehm47MChD4ZCs0mK9YsJV9lSH8+fnG1HpmFIX5YL61h6MRjeDciLS0YnVrOjUy3dw21jTFZP0kpNDU6PT2MkZF6BUyhEFMAw3Tv41sh50jlbExCitaJE+YaZpWnQeilfk+tfUpERRxM+B23Q7SJm5iKCyZRL1xBUChizVc6cI9pScnOzomoNp7Hd/DfbOR0PLNzgBUoxu20ydezrHPyR6YweCeCcifhOW2OAbYyZYnaiAEeUpHu0Kc4aZtRLW6n/CvW+TpIpB5eDD+IqG7TVRNE7dWUWrpEYx5a5tkHXqj9+2lGJooIMJXIYqK+psiu3Vm4JiM7TOOPdWpsW7JIjf8eb0ya1upBip8glR3wSMjCeXkCSGAwB49le4NJy7OaCiN0bbK1Jq3Tzo7qrboZJ56rn/1tYGjKBskKSrSvxnPX4HSELfvm/NIKd+7HlZo3FgV6DfgOMwwF5J38feZDKdRwbhzruNPNs/F7PnDSBou1hKLZqQ7CSu16GSI3SwtVK8aFHch1OaiFMRvvK6wHG+Etbv6ic4dQDa+R47WpZODFCiPPcYTti1VcPkz0xRh2we6xxCaO8U6cDAP0KYeGrKvx8WiI=
